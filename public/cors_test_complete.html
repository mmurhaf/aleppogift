<!DOCTYPE html>
<html>
<head>
    <title>aleppogift CORS Test Results</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .success { color: green; background: #f0f8f0; padding: 10px; border-radius: 5px; }
        .error { color: red; background: #fff0f0; padding: 10px; border-radius: 5px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; background: #007cba; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #005a87; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üéâ aleppogift CORS Test Results - FIXED!</h1>
    
    <div class="success">
        <h2>‚úÖ Issues Resolved:</h2>
        <ul>
            <li><strong>Database Connection:</strong> Fixed "No such file or directory" error</li>
            <li><strong>Session Headers:</strong> Resolved headers already sent conflicts</li>
            <li><strong>Database Schema:</strong> Updated to use correct multilingual columns (name_en/name_ar)</li>
            <li><strong>CORS Headers:</strong> Properly configured for cross-origin requests</li>
            <li><strong>Product Stock:</strong> Using products with available inventory</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h3>üß™ Test 1: CORS Headers</h3>
        <button onclick="testCORS()">Test CORS Response</button>
        <div id="cors-results"></div>
    </div>
    
    <div class="test-section">
        <h3>üõí Test 2: Add to Cart (Original Endpoint)</h3>
        <button onclick="testOriginalCart()">Test Original add_to_cart.php</button>
        <div id="original-results"></div>
    </div>
    
    <div class="test-section">
        <h3>üõí Test 3: Add to Cart (Fixed Endpoint)</h3>
        <button onclick="testFixedCart()">Test Fixed add_to_cart_fixed.php</button>
        <div id="fixed-results"></div>
    </div>
    
    <div class="test-section">
        <h3>üîÑ Test 4: OPTIONS Preflight Request</h3>
        <button onclick="testPreflight()">Test CORS Preflight</button>
        <div id="preflight-results"></div>
    </div>

    <script>
    function testCORS() {
        const results = document.getElementById('cors-results');
        results.innerHTML = '<p>Testing CORS headers...</p>';
        
        fetch('./ajax/cors_test.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'product_id=675&quantity=1'
        })
        .then(response => {
            console.log('Response Headers:', response.headers);
            return response.text();
        })
        .then(data => {
            results.innerHTML = '<div class="success"><h4>‚úÖ CORS Test SUCCESS!</h4><pre>' + data + '</pre></div>';
        })
        .catch(error => {
            results.innerHTML = '<div class="error"><h4>‚ùå CORS Test ERROR:</h4><pre>' + error + '</pre></div>';
        });
    }
    
    function testOriginalCart() {
        const results = document.getElementById('original-results');
        results.innerHTML = '<p>Testing original add_to_cart.php...</p>';
        
        fetch('./ajax/add_to_cart.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'product_id=675&quantity=1'
        })
        .then(response => response.text())
        .then(data => {
            try {
                const jsonData = JSON.parse(data);
                if (jsonData.success) {
                    results.innerHTML = '<div class="success"><h4>‚úÖ Original Cart SUCCESS!</h4><pre>' + JSON.stringify(jsonData, null, 2) + '</pre></div>';
                } else {
                    results.innerHTML = '<div class="error"><h4>‚ö†Ô∏è Original Cart Response:</h4><pre>' + JSON.stringify(jsonData, null, 2) + '</pre></div>';
                }
            } catch (e) {
                results.innerHTML = '<div class="error"><h4>‚ùå Original Cart ERROR:</h4><pre>' + data + '</pre></div>';
            }
        })
        .catch(error => {
            results.innerHTML = '<div class="error"><h4>‚ùå Original Cart ERROR:</h4><pre>' + error + '</pre></div>';
        });
    }
    
    function testFixedCart() {
        const results = document.getElementById('fixed-results');
        results.innerHTML = '<p>Testing fixed add_to_cart_fixed.php...</p>';
        
        fetch('./ajax/add_to_cart_fixed.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'product_id=675&quantity=1'
        })
        .then(response => response.text())
        .then(data => {
            try {
                const jsonData = JSON.parse(data);
                if (jsonData.success) {
                    results.innerHTML = '<div class="success"><h4>‚úÖ Fixed Cart SUCCESS!</h4><pre>' + JSON.stringify(jsonData, null, 2) + '</pre></div>';
                } else {
                    results.innerHTML = '<div class="error"><h4>‚ö†Ô∏è Fixed Cart Response:</h4><pre>' + JSON.stringify(jsonData, null, 2) + '</pre></div>';
                }
            } catch (e) {
                results.innerHTML = '<div class="error"><h4>‚ùå Fixed Cart ERROR:</h4><pre>' + data + '</pre></div>';
            }
        })
        .catch(error => {
            results.innerHTML = '<div class="error"><h4>‚ùå Fixed Cart ERROR:</h4><pre>' + error + '</pre></div>';
        });
    }
    
    function testPreflight() {
        const results = document.getElementById('preflight-results');
        results.innerHTML = '<p>Testing OPTIONS preflight request...</p>';
        
        fetch('./ajax/add_to_cart.php', {
            method: 'OPTIONS'
        })
        .then(response => {
            if (response.ok) {
                results.innerHTML = '<div class="success"><h4>‚úÖ Preflight SUCCESS!</h4><p>Status: ' + response.status + '</p></div>';
            } else {
                results.innerHTML = '<div class="error"><h4>‚ùå Preflight ERROR!</h4><p>Status: ' + response.status + '</p></div>';
            }
        })
        .catch(error => {
            results.innerHTML = '<div class="error"><h4>‚ùå Preflight ERROR:</h4><pre>' + error + '</pre></div>';
        });
    }
    
    // Auto-run all tests on page load
    window.onload = function() {
        setTimeout(testCORS, 500);
        setTimeout(testOriginalCart, 1000);
        setTimeout(testFixedCart, 1500);
        setTimeout(testPreflight, 2000);
    };
    </script>
</body>
</html>
