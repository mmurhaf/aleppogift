<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Countries Dropdown Test</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        .test-results {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <h1>Countries Dropdown Diagnostic</h1>
        
        <div class="test-results">
            <h3>Test Results:</h3>
            <div id="testResults"></div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h3>Shipping Form Test</h3>
            </div>
            <div class="card-body">
                <form action="shipping.php" method="GET">
                    <div class="mb-3">
                        <label for="testCountry" class="form-label">Test Country Dropdown:</label>
                        <select id="testCountry" name="country" class="form-select" required>
                            <option value="">Loading countries...</option>
                        </select>
                        <small class="form-text text-muted">This dropdown should populate automatically</small>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="testDropdown()">Test Dropdown</button>
                    <button type="submit" class="btn btn-success">Go to Shipping Page</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        let testResults = [];
        
        function addTestResult(test, result, details = '') {
            testResults.push({test, result, details});
            updateTestResults();
        }
        
        function updateTestResults() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = testResults.map(r => 
                `<div class="mb-2">
                    <strong>${r.test}:</strong> 
                    <span class="badge ${r.result ? 'bg-success' : 'bg-danger'}">${r.result ? 'PASS' : 'FAIL'}</span>
                    ${r.details ? `<br><small class="text-muted">${r.details}</small>` : ''}
                </div>`
            ).join('');
        }
        
        function testDropdown() {
            const dropdown = document.getElementById('testCountry');
            const optionCount = dropdown.options.length;
            
            addTestResult('Dropdown exists', !!dropdown);
            addTestResult('Has options', optionCount > 1, `Found ${optionCount} options`);
            
            if (optionCount > 1) {
                const firstCountry = dropdown.options[1].text;
                addTestResult('First country loaded', !!firstCountry, `First country: ${firstCountry}`);
            }
            
            // More comprehensive Bootstrap check
            const bootstrapLoaded = !!(window.bootstrap);
            const cssLoaded = !!document.querySelector('link[href*="bootstrap"]');
            const hasBootstrapClasses = dropdown.classList.contains('form-select');
            
            addTestResult('Bootstrap JS loaded', bootstrapLoaded, 'Bootstrap JavaScript framework check');
            addTestResult('Bootstrap CSS loaded', cssLoaded, 'Bootstrap CSS framework check');
            addTestResult('Form select class', hasBootstrapClasses, 'Bootstrap styling check');
            
            // Check if Bootstrap styles are actually applied
            const computedStyle = window.getComputedStyle(dropdown);
            const hasBootstrapStyling = computedStyle.padding !== '' && computedStyle.border !== '';
            addTestResult('Bootstrap styles applied', hasBootstrapStyling, 'Visual styling check');
            
            // Overall functionality check
            const overallWorking = dropdown.options.length > 1 && hasBootstrapClasses && hasBootstrapStyling;
            addTestResult('Overall functionality', overallWorking, 'Complete shipping calculator check');
        }
        
        // Load countries via AJAX to test API
        async function loadCountries() {
            try {
                addTestResult('Starting API test', true, 'Fetching countries from API...');
                
                const response = await fetch('https://restcountries.com/v3.1/all?fields=name,cca2');
                const countries = await response.json();
                
                addTestResult('API response received', !!countries, `Received ${countries?.length || 0} countries`);
                
                if (countries && countries.length > 0) {
                    // Sort countries alphabetically
                    countries.sort((a, b) => a.name.common.localeCompare(b.name.common));
                    
                    const dropdown = document.getElementById('testCountry');
                    dropdown.innerHTML = '<option value="">-- Select Country --</option>';
                    
                    countries.forEach(country => {
                        const option = document.createElement('option');
                        option.value = country.name.common;
                        option.textContent = `${getFlag(country.cca2)} ${country.name.common}`;
                        dropdown.appendChild(option);
                    });
                    
                    addTestResult('Countries populated', true, `Successfully loaded ${countries.length} countries`);
                } else {
                    addTestResult('Countries populated', false, 'No countries received from API');
                }
            } catch (error) {
                addTestResult('API call failed', false, `Error: ${error.message}`);
                
                // Fallback to basic countries
                const fallbackCountries = [
                    'United Arab Emirates', 'United States', 'Germany', 'France', 
                    'United Kingdom', 'Qatar', 'Saudi Arabia', 'Canada', 'Australia'
                ];
                
                const dropdown = document.getElementById('testCountry');
                dropdown.innerHTML = '<option value="">-- Select Country --</option>';
                
                fallbackCountries.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country;
                    option.textContent = country;
                    dropdown.appendChild(option);
                });
                
                addTestResult('Fallback countries loaded', true, `Loaded ${fallbackCountries.length} fallback countries`);
            }
        }
        
        function getFlag(countryCode) {
            return String.fromCodePoint(...countryCode.toUpperCase().split('').map(c => 127397 + c.charCodeAt()));
        }
        
        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', function() {
            addTestResult('Page loaded', true, 'DOM content loaded successfully');
            loadCountries();
            
            // Check Bootstrap JS after a delay to allow loading
            setTimeout(() => {
                testDropdown();
            }, 2000);
        });
    </script>
</body>
</html>