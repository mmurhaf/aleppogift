<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart Debug Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Cart Debug Test</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Add to Cart</h5>
                    </div>
                    <div class="card-body">
                        <button id="testAddBtn" class="btn btn-primary">
                            <i class="fas fa-shopping-cart me-2"></i>Add Test Product to Cart
                        </button>
                        <div id="testResult" class="mt-3"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Cart Preview Test</h5>
                    </div>
                    <div class="card-body">
                        <button id="loadCartBtn" class="btn btn-info">
                            <i class="fas fa-refresh me-2"></i>Load Cart Preview
                        </button>
                        <div id="cartPreviewTest" class="mt-3 border p-2"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Session Debug Info</h5>
                    </div>
                    <div class="card-body">
                        <button id="sessionInfoBtn" class="btn btn-warning">
                            <i class="fas fa-info me-2"></i>Get Session Info
                        </button>
                        <div id="sessionInfo" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Console Log</h5>
                    </div>
                    <div class="card-body">
                        <div id="consoleLog" class="bg-dark text-light p-3" style="height: 200px; overflow-y: auto; font-family: monospace;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        function log(message) {
            const logDiv = document.getElementById('consoleLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        // Test Add to Cart
        document.getElementById('testAddBtn').addEventListener('click', function() {
            log('Testing add to cart...');
            
            fetch('ajax/add_to_cart.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'product_id=1&quantity=1'
            })
            .then(response => {
                log(`Response status: ${response.status}`);
                return response.text();
            })
            .then(data => {
                log(`Response data: ${data}`);
                document.getElementById('testResult').innerHTML = `<pre>${data}</pre>`;
                
                try {
                    const jsonData = JSON.parse(data);
                    if (jsonData.success) {
                        log('✅ Add to cart successful!');
                    } else {
                        log(`❌ Add to cart failed: ${jsonData.message}`);
                    }
                } catch (e) {
                    log(`❌ Invalid JSON response: ${e.message}`);
                }
            })
            .catch(error => {
                log(`❌ Network error: ${error.message}`);
                document.getElementById('testResult').innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            });
        });

        // Test Cart Preview
        document.getElementById('loadCartBtn').addEventListener('click', function() {
            log('Loading cart preview...');
            
            fetch('ajax/cart_preview.php')
            .then(response => {
                log(`Cart preview response status: ${response.status}`);
                return response.text();
            })
            .then(data => {
                log(`Cart preview data length: ${data.length} characters`);
                document.getElementById('cartPreviewTest').innerHTML = data;
                
                if (data.trim() === '') {
                    log('❌ Cart preview returned empty response');
                } else if (data.includes('text-center py-4')) {
                    log('ℹ️ Cart appears to be empty (showing empty cart message)');
                } else {
                    log('✅ Cart preview loaded successfully');
                }
            })
            .catch(error => {
                log(`❌ Cart preview error: ${error.message}`);
                document.getElementById('cartPreviewTest').innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            });
        });

        // Test Session Info
        document.getElementById('sessionInfoBtn').addEventListener('click', function() {
            log('Getting session info...');
            
            fetch('debug_session_cart.php')
            .then(response => response.text())
            .then(data => {
                log('Session info received');
                document.getElementById('sessionInfo').innerHTML = `<pre>${data}</pre>`;
            })
            .catch(error => {
                log(`❌ Session info error: ${error.message}`);
                document.getElementById('sessionInfo').innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            });
        });

        // Load cart preview on page load
        log('Page loaded - testing cart preview...');
        document.getElementById('loadCartBtn').click();
    </script>
</body>
</html>
